<!DOCTYPE html>
<!--
To change this license header, choose License Headers in Project Properties.
To change this template file, choose Tools | Templates
and open the template in the editor.
-->
<html  xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout" layout:decorate="~{layout.html}">
    <head>
        <title>trainer</title>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
    </head>
    <body>
        <section layout:fragment="judulHero">
            <h4> Edit Nilai</h4>
        </section>
        <section layout:fragment="content">

            <!--tabel-->
            <div class="container table__container" style="background-color: white">
                <div class="row table__wrapper">
                    <table class="table table-striped" id="tabel_ssts">
                        <thead>
                            <tr>
                                <th>Nama</th>
                                <th>Nilai</th>
                                <th>Action</th>
                            </tr>
                        </thead>
                        <tbody>

                        </tbody>
                    </table>
                </div>
            </div>


            <!-- Update Modal -->
            <div class="modal fade" id="updateModal" tabindex="-1" aria-labelledby="updateModalLabel" aria-hidden="true">
                <div class="modal-dialog">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h5 class="modal-title" id="updateModalLabel">Modal title</h5>
                            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                        </div>
                        <div class="modal-body">
                            <form id="updateForm">
                                <div class="col">
                                    <input class="form-control" type="number" name="id" id="edit_id" placeholder="Employee id" style="visibility: hidden">
                                </div>
                                <!--
                                <div class="col">
                                    <label class="form-label ">nama : </label>
                                    <input class="form-control" type="text" name="id" id="edit_nama" placeholder="nama">
                                </div>-->
                                <div class="col">
                                    <label class="form-label ">nilai : </label>
                                    <input class="form-control" type="number" name="id" id="edit_nilai" placeholder="nilai">
                                </div>

                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                            <button type="submit" class="btn btn-primary" id="submitUpdateModal">Simpan</button>
                        </div>
                        </form>
                    </div>
                </div>
            </div>

        </section>

        <script layout:fragment="scripts">

            //Inisialisasi data table dengan ajax
            var class_id = window.location.href.split('/')[6];
            var sts_id = window.location.href.split('/')[7];
            var tb = $('#tabel_ssts').DataTable({
                ajax: {
                    url: '/subsubject_transcript/edit/' + class_id + "/" + sts_id,
                    dataSrc: 'data'
                },
                columns: [
                    {data: 'fullname'},
                    {data: 'nilai'},
                    {
                        "data": null,
                        render: function (data, type, row, meta) {
                            return ` 
                            <button type="button" class="btn btn-sm btn-warning" data-bs-toggle="modal"
                                data-bs-target="#updateModal" onclick="editById(${data.subSubjectId})">
                                Edit
                            </button>`;
                        }
                    }
                ],
                "filter": false,
                "ordering": false,
                "lengthChange": false,
                "language": {
                    "info": "_START_ - _END_ of _TOTAL_ items",
                    "infoEmpty": "0 to 0 of 0 items",
                    "infoFiltered": "(filtered from _MAX_ items)",
                }
            });

            $("#submitUpdateModal").click(function (e) {
                e.preventDefault();
                let sstsId = $('#edit_id').val();
                let nilai = $('#edit_nilai').val();
                if (nilai != '') {
                    $.ajax({
                        method: "PUT",
                        url: '/subsubject_transcript/inputnilai',
                        dataType: "json",
                        data: JSON.stringify({
                            sstsId: sstsId,
                            nilai: nilai
                        }),
                        contentType: "application/json",
                        success: function (result) {
                            $('#updateModal').modal("hide");
                            $('.modal-backdrop').remove();
                            tb.ajax.reload();
                            customSweetAlert(result.message);
                        }
                    });
                } else {
                    alert('You are missing Score.')
                }
            });



            function editById(subSubjectId) {
                $.ajax({
                    method: "GET",
                    url: '/subsubject_transcript/id/' + subSubjectId,
                    dataType: "json",
                    contentType: "application/json",
                    success: function (result) {
                        console.log("SUCCESS : ", result);
                        $('#edit_id').val(`${subSubjectId}`);
                        $('#edit_nilai').val(`${result.data.nilai}`);
                    }
                })
            }
        </script>
    </body>
</html>
